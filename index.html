<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>SERON Chat</title>

<style>
body{
margin:0;
font-family:Arial;
background:#0b141a;
color:white;
display:flex;
flex-direction:column;
align-items:center;
}

/* ðŸ”¥ SERON Branding */
.brand{
text-align:center;
font-size:24px;
font-weight:bold;
color:#ff5722;
text-shadow:0 0 15px orange;
margin:10px;
}

/* 16:9 Chat Box */
.container{
width:95vw;
max-width:900px;
aspect-ratio:16/9;
background:#111b21;
display:flex;
flex-direction:column;
border-radius:12px;
overflow:hidden;
}

/* Header */
header{
background:#202c33;
padding:10px;
display:flex;
justify-content:space-between;
}

/* Chat */
#chat{
flex:1;
overflow-y:auto;
padding:10px;
}

.msg{
padding:8px;
margin:6px;
border-radius:8px;
max-width:70%;
}

.me{ background:#005c4b; margin-left:auto; }
.other{ background:#202c33; }

.controls{
display:flex;
gap:5px;
padding:8px;
background:#202c33;
}

input{
flex:1;
padding:10px;
border:none;
border-radius:6px;
}

button{
padding:10px;
border:none;
border-radius:6px;
cursor:pointer;
}

/* Menu */
.menu{
text-align:center;
margin-top:40px;
}

.roomCode{
font-size:18px;
margin-top:15px;
word-break:break-all;
}

.footer{
margin-top:10px;
color:#ff5722;
text-shadow:0 0 10px orange;
}

</style>
</head>

<body>

<div class="brand">ðŸ”¥ SERON ðŸ”¥</div>

<!-- MENU -->
<div id="menu" class="menu">

<h2>Chat Room</h2>

<button onclick="createRoom()">Create Room</button>
<br><br>

<input id="joinCode" placeholder="Enter or Paste Room Code">
<br><br>

<button onclick="pasteCode()">Paste</button>
<button onclick="joinRoom()">Join</button>

<div id="roomDisplay" class="roomCode"></div>

</div>

<!-- CHAT -->
<div id="chatUI" class="container" style="display:none">

<header>
<div>Room: <span id="roomLabel"></span></div>
<div>
<button onclick="shareRoom()">Share</button>
<button onclick="adminDelete()">Delete</button>
</div>
</header>

<div id="chat"></div>

<div class="controls">
<input id="msg" placeholder="Type message">
<button onclick="sendMsg()">Send</button>
<button onclick="leave()">Leave</button>
</div>

</div>

<div class="footer">ðŸ”¥ SERON ðŸ”¥</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, push, set, onValue, remove } 
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

/* Firebase */
const firebaseConfig = {
apiKey:"AIzaSyC4...",
authDomain:"chat-data-59467.firebaseapp.com",
databaseURL:"https://chat-data-59467-default-rtdb.asia-southeast1.firebasedatabase.app",
projectId:"chat-data-59467"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let room="";
let user="User"+Math.floor(Math.random()*9999);

/* Generate 16 digit */
function genCode(){
let c="";
for(let i=0;i<16;i++){
c+=Math.floor(Math.random()*10);
}
return c;
}

/* CREATE ROOM */
window.createRoom=function(){

room=genCode();

document.getElementById("roomDisplay").innerHTML=
"Room Code:<br>"+room+
"<br><br><button onclick='copyCode()'>Copy Code</button>";

}

/* COPY */
window.copyCode=function(){
navigator.clipboard.writeText(room);
alert("Copied!");
}

/* PASTE */
window.pasteCode=async function(){
let t=await navigator.clipboard.readText();
document.getElementById("joinCode").value=t;
}

/* JOIN ROOM */
window.joinRoom=function(){

room=document.getElementById("joinCode").value;

if(!room){
alert("Invalid Room");
return;
}

startChat();

}

/* START CHAT */
function startChat(){

document.getElementById("menu").style.display="none";
document.getElementById("chatUI").style.display="flex";

document.getElementById("roomLabel").innerText=room;

set(ref(db,"rooms/"+room+"/users/"+user),true);

listen();

}

/* LISTEN CHAT */
function listen(){

onValue(ref(db,"rooms/"+room+"/messages"),snap=>{

let chat=document.getElementById("chat");
chat.innerHTML="";

snap.forEach(m=>{
let d=m.val();
let div=document.createElement("div");
div.className="msg "+(d.user==user?"me":"other");
div.innerText=d.user+": "+d.text;
chat.appendChild(div);
});

});

}

/* SEND */
window.sendMsg=function(){

let text=document.getElementById("msg").value;
if(!text) return;

push(ref(db,"rooms/"+room+"/messages"),{
user:user,
text:text
});

document.getElementById("msg").value="";

}

/* LEAVE */
window.leave=function(){
remove(ref(db,"rooms/"+room+"/users/"+user));
location.href=location.pathname;
}

/* ADMIN DELETE */
window.adminDelete=function(){

if(confirm("Delete Room?")){
remove(ref(db,"rooms/"+room));
alert("Deleted");
location.reload();
}

}

/* SHARE */
window.shareRoom=function(){

let link=location.origin+location.pathname+"?room="+room;

navigator.share?.({
title:"Join SERON Chat",
text:"Join my room",
url:link
}) || alert(link);

}

/* ðŸ”¥ AUTO JOIN FROM LINK */
function autoJoin(){

const params=new URLSearchParams(window.location.search);
const r=params.get("room");

if(r){
room=r;
startChat();
}

}

autoJoin();

</script>

</body>
</html>
