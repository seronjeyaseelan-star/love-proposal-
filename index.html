<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ultra Chat</title>

<style>
*{box-sizing:border-box}
body{
 margin:0;
 font-family:Arial;
 overflow:hidden;
 transition:0.3s;
}
.dark{background:#0f172a;color:white}
.light{background:#f1f5f9;color:black}

/* FULL SCREEN CHAT */
#chat{
 display:none;
 height:100vh;
 display:flex;
 flex-direction:column;
}

/* TOP BAR */
.top{
 display:flex;
 justify-content:space-between;
 padding:10px;
 backdrop-filter:blur(10px);
}

/* MESSAGE AREA */
#messages{
 flex:1;
 overflow:auto;
 padding:10px;
}

/* MESSAGE STYLE */
.msg{
 padding:8px;
 margin:6px;
 border-radius:12px;
 animation:fade 0.3s ease;
}
@keyframes fade{
 from{opacity:0; transform:translateY(10px)}
 to{opacity:1}
}

/* INPUT AREA */
.bottom{
 display:flex;
 padding:10px;
 gap:5px;
}

/* ICON BUTTONS */
.iconBtn{
 width:45px;
 height:45px;
 border-radius:50%;
 border:none;
 font-size:20px;
 cursor:pointer;
 background:#22c55e;
 color:white;
}

/* ROOM PAGE */
#roomPage{
 display:flex;
 flex-direction:column;
 align-items:center;
 justify-content:center;
 height:100vh;
 gap:10px;
}

/* ANIMATION */
.glow{
 animation:glow 2s infinite alternate;
}
@keyframes glow{
 from{box-shadow:0 0 5px #22c55e}
 to{box-shadow:0 0 20px #22c55e}
}
</style>
</head>

<body class="dark">

<!-- ROOM PAGE -->
<div id="roomPage">
<h2 class="glow">Realtime Room Chat</h2>

<button onclick="createRoom()">Create Room</button>
<input id="roomInput" placeholder="Room ID">
<button onclick="joinRoom()">Join</button>
<div id="error" style="color:red"></div>
</div>

<!-- CHAT PAGE -->
<div id="chat">
<div class="top">
<div id="roomTitle"></div>
<div>
<button class="iconBtn" onclick="toggleTheme()">ðŸŒ“</button>
<button class="iconBtn" id="destroyBtn" onclick="destroyRoom()" style="display:none">ðŸ’£</button>
</div>
</div>

<div id="messages"></div>

<div class="bottom">
<input id="msg" placeholder="Message" style="flex:1;padding:10px;border-radius:10px">
<button class="iconBtn" onclick="sendMsg()">âž¤</button>
<button class="iconBtn" onclick="startRecord()">ðŸŽ¤</button>
<input type="file" id="imgFile" hidden accept="image/*" onchange="sendImage(event)">
<button class="iconBtn" onclick="imgFile.click()">ðŸ–¼</button>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, set, push, onChildAdded, onValue, remove }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

/* FIREBASE CONFIG */
const firebaseConfig = {
 apiKey: "AIzaSyC4mYZ5G-WCjt7wAN0G6_B6rh1LDM10U0Q",
 authDomain: "chat-data-59467.firebaseapp.com",
 databaseURL: "https://chat-data-59467-default-rtdb.asia-southeast1.firebasedatabase.app",
 projectId: "chat-data-59467",
 storageBucket: "chat-data-59467.firebasestorage.app",
 messagingSenderId: "237808362163",
 appId: "1:237808362163:web:52d25dfbffaffde12446c6"
};

const app=initializeApp(firebaseConfig);
const db=getDatabase(app);

/* VARIABLES */
let room="";
let admin=false;
let destroyTime=0;
let msgRef;

/* USER COLOR */
const colors=["#22c55e","#3b82f6","#f59e0b","#ef4444","#a855f7"];
const user="User-"+Math.floor(Math.random()*999);
const userColor=colors[Math.floor(Math.random()*colors.length)];

/* CREATE ROOM */
window.createRoom=()=>{
 room=Math.random().toString(36).substring(2,6);
 admin=true;

 let t=prompt("Destroy room after minutes? (Optional)");
 if(t) destroyTime=parseInt(t)*60000;

 startChat();
}

/* JOIN ROOM */
window.joinRoom=()=>{
 let r=document.getElementById("roomInput").value;
 if(!r){
  document.getElementById("error").innerText="Enter Room ID";
  return;
 }
 room=r;
 startChat();
}

/* START CHAT */
function startChat(){
 document.getElementById("roomPage").style.display="none";
 document.getElementById("chat").style.display="flex";
 document.getElementById("roomTitle").innerText="Room: "+room;

 msgRef=ref(db,"rooms/"+room+"/messages");

 if(admin){
  document.getElementById("destroyBtn").style.display="inline-block";

  if(destroyTime){
   setTimeout(()=>{
    destroyRoom();
   },destroyTime);
  }
 }

 onChildAdded(msgRef,s=>{
  let m=s.val();
  let div=document.createElement("div");
  div.className="msg";
  div.style.background=m.color+"33";

  if(m.type=="text"){
   div.innerHTML="<b style='color:"+m.color+"'>"+m.user+"</b><br>"+m.text;
  }
  if(m.type=="img"){
   div.innerHTML="<b style='color:"+m.color+"'>"+m.user+"</b><br><img src='"+m.text+"' width=150>";
  }
  if(m.type=="voice"){
   div.innerHTML="<b style='color:"+m.color+"'>"+m.user+"</b><br><audio controls src='"+m.text+"'></audio>";
  }

  document.getElementById("messages").appendChild(div);
 });
}

/* SEND TEXT */
window.sendMsg=()=>{
 let text=document.getElementById("msg").value;
 if(!text) return;

 push(msgRef,{user:user,color:userColor,type:"text",text:text});
 document.getElementById("msg").value="";
}

/* SEND IMAGE */
window.sendImage=(e)=>{
 let file=e.target.files[0];
 let reader=new FileReader();
 reader.onload=()=>{
  push(msgRef,{user:user,color:userColor,type:"img",text:reader.result});
 };
 reader.readAsDataURL(file);
}

/* VOICE RECORD MAX 1 MIN */
let recorder;
let chunks=[];

window.startRecord=async()=>{
 let stream=await navigator.mediaDevices.getUserMedia({audio:true});
 recorder=new MediaRecorder(stream);
 recorder.start();

 recorder.ondataavailable=e=>chunks.push(e.data);

 recorder.onstop=()=>{
  let blob=new Blob(chunks,{type:"audio/mp3"});
  let reader=new FileReader();
  reader.onload=()=>{
   push(msgRef,{user:user,color:userColor,type:"voice",text:reader.result});
  };
  reader.readAsDataURL(blob);
  chunks=[];
 };

 setTimeout(()=>recorder.stop(),60000); // 1 MINUTE
}

/* DESTROY ROOM */
window.destroyRoom=()=>{
 if(confirm("Destroy room?")){
  remove(ref(db,"rooms/"+room));
  alert("Room Destroyed");
  location.reload();
 }
}

/* THEME */
window.toggleTheme=()=>{
 let b=document.body;
 b.classList.toggle("dark");
 b.classList.toggle("light");
}
</script>

</body>
  </html>
